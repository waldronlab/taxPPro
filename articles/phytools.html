<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A propagation workflow with taxonomic pooling, asr (phytools), and inheritance • taxPPro</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="A propagation workflow with taxonomic pooling, asr (phytools), and inheritance">
<meta property="og:description" content="taxPPro">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">taxPPro</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/phytools.html">A propagation workflow with taxonomic pooling, asr (phytools), and inheritance</a>
    </li>
    <li>
      <a href="../articles/phytools2.html">A propagation workflow with taxonomic pooling, asr (phytools), and inheritance (compact version)</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/sdgamboa/taxPPro/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>A propagation workflow with taxonomic pooling,
asr (phytools), and inheritance</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sdgamboa/taxPPro/blob/HEAD/vignettes/articles/phytools.Rmd" class="external-link"><code>vignettes/articles/phytools.Rmd</code></a></small>
      <div class="hidden name"><code>phytools.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/waldronlab/bugphyzz" class="external-link">bugphyzz</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sdgamboa/taxPPro" class="external-link">taxPPro</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/gluc/data.tree" class="external-link">data.tree</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/liamrevell/phytools" class="external-link">phytools</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="import-physiology-data">Import physiology data<a class="anchor" aria-label="anchor" href="#import-physiology-data"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">phys_name</span> <span class="op">&lt;-</span> <span class="st">'aerophilicity'</span></span>
<span><span class="va">phys</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bugphyzz/man/physiologies.html" class="external-link">physiologies</a></span><span class="op">(</span><span class="va">phys_name</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="filter-data">Filter data<a class="anchor" aria-label="anchor" href="#filter-data"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">select_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">'NCBI_ID'</span>, <span class="st">'Taxon_name'</span>, <span class="st">'Parent_NCBI_ID'</span>,</span>
<span>    <span class="st">'Attribute'</span>,<span class="st">'Attribute_source'</span>, <span class="st">'Confidence_in_curation'</span>,</span>
<span>    <span class="st">'Frequency'</span>, <span class="st">'Score'</span>, <span class="st">'Evidence'</span>, </span>
<span>    <span class="st">'Attribute_type'</span>, <span class="st">'Attribute_group'</span></span>
<span><span class="op">)</span></span>
<span><span class="va">valid_ranks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'genus'</span>, <span class="st">'species'</span>, <span class="st">'strain'</span><span class="op">)</span></span>
<span><span class="va">attributes_fname</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span>
<span>    <span class="st">'extdata'</span>, <span class="st">'attributes.tsv'</span>, package <span class="op">=</span> <span class="st">'bugphyzz'</span></span>
<span><span class="op">)</span></span>
<span><span class="va">attributes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="va">attributes_fname</span>, sep <span class="op">=</span> <span class="st">'\t'</span>, header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">valid_attributes</span> <span class="op">&lt;-</span> <span class="va">attributes</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">attribute_group</span> <span class="op">==</span> <span class="va">phys_name</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">attribute</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">phys_data</span> <span class="op">&lt;-</span> <span class="va">phys</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Attribute_value</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Attribute</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">valid_attributes</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>        <span class="op">!</span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">NCBI_ID</span><span class="op">)</span> <span class="op">|</span> <span class="va">NCBI_ID</span> <span class="op">==</span> <span class="st">'unknown'</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Parent_NCBI_ID</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="st">'Attribute_source'</span><span class="op">)</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="st">'Frequency'</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Score <span class="op">=</span> <span class="fu"><a href="../reference/freq2Scores.html">freq2Scores</a></span><span class="op">(</span><span class="va">Frequency</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="va">select_cols</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">n_dropped_rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">phys</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">phys_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">n_dropped_rows</span>, big.mark <span class="op">=</span> <span class="st">','</span><span class="op">)</span>, <span class="st">' rows were dropped.'</span><span class="op">)</span></span>
<span><span class="co">#&gt; 3,891 rows were dropped.</span></span></code></pre></div>
<p>Some variables that I need</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Attribute_group_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">phys_data</span><span class="op">$</span><span class="va">Attribute_group</span><span class="op">)</span></span>
<span><span class="va">Attribute_group_var</span></span>
<span><span class="co">#&gt; [1] "aerophilicity"</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Attribute_type_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">phys_data</span><span class="op">$</span><span class="va">Attribute_type</span><span class="op">)</span></span>
<span><span class="va">Attribute_type_var</span></span>
<span><span class="co">#&gt; [1] "multistate-intersection"</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ordered_colnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">'NCBI_ID'</span>, <span class="st">'Taxon_name'</span>, <span class="st">'Rank'</span>,</span>
<span>    <span class="st">'Attribute'</span>, <span class="st">'Attribute_source'</span>, <span class="st">'Confidence_in_curation'</span>,</span>
<span>    <span class="st">'Evidence'</span>, <span class="st">'Frequency'</span>, <span class="st">'Score'</span>,</span>
<span>    <span class="st">'Attribute_group'</span>, <span class="st">'Attribute_type'</span>,</span>
<span>    <span class="st">'taxid'</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="taxonomic-pooling-for-taxa-without-ncbi_id-taxid">Taxonomic pooling for taxa without NCBI_ID (taxid)<a class="anchor" aria-label="anchor" href="#taxonomic-pooling-for-taxa-without-ncbi_id-taxid"></a>
</h2>
<p>Divide data in two sets between taxa with or without NCBI_ID:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lgl_vct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">phys_data</span><span class="op">$</span><span class="va">NCBI_ID</span><span class="op">)</span> <span class="op">|</span> <span class="va">phys_data</span><span class="op">$</span><span class="va">NCBI_ID</span> <span class="op">==</span> <span class="st">'unknown'</span></span>
<span><span class="va">set_with_ids</span> <span class="op">&lt;-</span> <span class="va">phys_data</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">lgl_vct</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Rank <span class="op">=</span> <span class="fu">taxizedb</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/taxizedb/reference/taxid2rank.html" class="external-link">taxid2rank</a></span><span class="op">(</span><span class="va">NCBI_ID</span>, db <span class="op">=</span> <span class="st">'ncbi'</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Rank</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">valid_ranks</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Taxon_name <span class="op">=</span> <span class="fu">taxizedb</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/taxizedb/reference/taxid2name.html" class="external-link">taxid2name</a></span><span class="op">(</span><span class="va">NCBI_ID</span>, db <span class="op">=</span> <span class="st">'ncbi'</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Confidence_in_curation <span class="op">=</span>  <span class="fu"><a href="../reference/conf2Fct.html">conf2Fct</a></span><span class="op">(</span><span class="va">Confidence_in_curation</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">NCBI_ID</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_max</a></span><span class="op">(</span><span class="va">Confidence_in_curation</span>, n <span class="op">=</span> <span class="fl">1</span>, with_ties <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">NCBI_ID</span>, <span class="va">Attribute</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_max</a></span><span class="op">(</span><span class="va">Attribute_source</span>, n <span class="op">=</span> <span class="fl">1</span>, with_ties <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">NCBI_ID</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Total_score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Score</span><span class="op">)</span>, Score <span class="op">=</span> <span class="va">Score</span> <span class="op">/</span> <span class="va">Total_score</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Frequency <span class="op">=</span> <span class="fu"><a href="../reference/scores2Freq.html">scores2Freq</a></span><span class="op">(</span><span class="va">Score</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Parent_NCBI_ID</span>, <span class="op">-</span><span class="va">Total_score</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>taxid <span class="op">=</span> <span class="va">NCBI_ID</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>NCBI_ID <span class="op">=</span> <span class="fu"><a href="../reference/addRankPrefix.html">addRankPrefix</a></span><span class="op">(</span><span class="va">NCBI_ID</span>, <span class="va">Rank</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">NCBI_ID</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">NCBI_ID</span>, <span class="va">Attribute</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="va">ordered_colnames</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: There was 1 warning in `mutate()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In argument: `Rank = taxizedb::taxid2rank(NCBI_ID, db = "ncbi")`.</span></span>
<span><span class="co">#&gt; Caused by warning in `taxizedb::taxid2rank()`:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> No rank found for 84 of 10425 taxon IDs. The followings are left unrankd: 65497, 287094, 196083, 136160, 513651, 1606016, 1646339, 126790, 1830421, 1400058, 165807, 134962, 48937, 263820, 1311788, 342610, 166934, 1398496, 307251, 219742, 154109, 1462563, 219741, 262776, 45461, 211759, 244407, 332057, 332056, 46170, 46170, 68202, 84593, 62153, 109214, 1398560, 355929, 866775, 1551, 1560, 86662, 168810, 495036, 1345697, 1166016, 741091, 195041, 140100, 62153, 675810, 65497, 861208, 340044, 335659, 546899, 656024, 440512, 147710, 931223, 420233, 332056, 68570, 68202, 563191, 665937, 469586, 469587, 665938, 469594, 52765, 52766, 699245, 97139, 327817, 644968, 228748, 477693, 652712, 796939, 796940, 36876, 93930, 220622, 1796653</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">set_with_ids</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 9609   12</span></span></code></pre></div>
<p>Get attribute annotations and scores for taxa without NCBI_ID from
sources:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">set_without_ids</span> <span class="op">&lt;-</span> <span class="va">phys_data</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">lgl_vct</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>        <span class="op">-</span><span class="va">NCBI_ID</span>, <span class="op">-</span><span class="va">Taxon_name</span>, <span class="op">-</span><span class="va">Frequency</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span>NCBI_ID <span class="op">=</span> <span class="va">Parent_NCBI_ID</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Rank <span class="op">=</span> <span class="fu">taxizedb</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/taxizedb/reference/taxid2rank.html" class="external-link">taxid2rank</a></span><span class="op">(</span><span class="va">NCBI_ID</span>, db <span class="op">=</span> <span class="st">'ncbi'</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Rank</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">valid_ranks</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Taxon_name <span class="op">=</span> <span class="fu">taxizedb</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/taxizedb/reference/taxid2name.html" class="external-link">taxid2name</a></span><span class="op">(</span><span class="va">NCBI_ID</span>, db <span class="op">=</span> <span class="st">'ncbi'</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Confidence_in_curation <span class="op">=</span>  <span class="fu"><a href="../reference/conf2Fct.html">conf2Fct</a></span><span class="op">(</span><span class="va">Confidence_in_curation</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">NCBI_ID</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_max</a></span><span class="op">(</span><span class="va">Confidence_in_curation</span>, n <span class="op">=</span> <span class="fl">1</span>, with_ties <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">NCBI_ID</span>, <span class="va">Attribute</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_max</a></span><span class="op">(</span><span class="va">Attribute_source</span>, n <span class="op">=</span> <span class="fl">1</span>, with_ties <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">NCBI_ID</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Total_score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Score</span><span class="op">)</span>, Score <span class="op">=</span> <span class="va">Score</span> <span class="op">/</span> <span class="va">Total_score</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Frequency <span class="op">=</span> <span class="fu"><a href="../reference/scores2Freq.html">scores2Freq</a></span><span class="op">(</span><span class="va">Score</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        Evidence <span class="op">=</span> <span class="st">'tax'</span>,</span>
<span>        Attribute_group <span class="op">=</span> <span class="va">Attribute_group_var</span>,</span>
<span>        Attribute_type <span class="op">=</span> <span class="va">Attribute_type_var</span>,</span>
<span>        Attribute_source <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>        Confidence_in_curation <span class="op">=</span> <span class="cn">NA</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Total_score</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>taxid <span class="op">=</span> <span class="va">NCBI_ID</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>NCBI_ID <span class="op">=</span> <span class="fu"><a href="../reference/addRankPrefix.html">addRankPrefix</a></span><span class="op">(</span><span class="va">NCBI_ID</span>, <span class="va">Rank</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">NCBI_ID</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">NCBI_ID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">set_with_ids</span><span class="op">$</span><span class="va">NCBI_ID</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">NCBI_ID</span>, <span class="va">Attribute</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="va">ordered_colnames</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: There was 1 warning in `mutate()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In argument: `Rank = taxizedb::taxid2rank(NCBI_ID, db = "ncbi")`.</span></span>
<span><span class="co">#&gt; Caused by warning in `taxizedb::taxid2rank()`:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> No rank found for 5 of 15276 taxon IDs. The followings are left unrankd: 1765963, 2751472, 2679994, 1704088, 648567</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">set_without_ids</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 6502   12</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">phys_data_ready</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">set_with_ids</span>, <span class="va">set_without_ids</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/complete.html" class="external-link">complete</a></span><span class="op">(</span><span class="va">NCBI_ID</span>, <span class="va">Attribute</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Score <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">NCBI_ID</span>, <span class="va">Attribute</span><span class="op">)</span></span>
<span><span class="va">phys_data_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">phys_data_ready</span>, <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">phys_data_ready</span><span class="op">$</span><span class="va">NCBI_ID</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">phys_data_list</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 15866</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="tree-data">Tree data<a class="anchor" aria-label="anchor" href="#tree-data"></a>
</h2>
<div class="section level3">
<h3 id="taxonomic-tree">Taxonomic tree<a class="anchor" aria-label="anchor" href="#taxonomic-tree"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">'tree_list'</span><span class="op">)</span></span>
<span><span class="va">ncbi_tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.tree/man/as.Node.html" class="external-link">as.Node</a></span><span class="op">(</span><span class="va">tree_list</span><span class="op">)</span></span>
<span><span class="va">ncbi_tree_nodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="va">ncbi_tree</span><span class="op">$</span><span class="fu">Get</span><span class="op">(</span><span class="st">'name'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">ncbi_tree</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Node" "R6"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="phylogenectic-tree">Phylogenectic tree<a class="anchor" aria-label="anchor" href="#phylogenectic-tree"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ltp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ltp.html">ltp</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Initial number of tips in LTP tree: 19452</span></span>
<span><span class="co">#&gt; Dropping 1038 tips with zero length branches.</span></span>
<span><span class="co">#&gt; Dropping 89 tips because of duplicated taxids.</span></span>
<span><span class="co">#&gt; Tips remaining: 18325</span></span>
<span><span class="va">tree</span> <span class="op">&lt;-</span> <span class="va">ltp</span><span class="op">$</span><span class="va">tree</span></span>
<span><span class="va">tree</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Phylogenetic tree with 18325 tips and 18324 internal nodes.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Tip labels:</span></span>
<span><span class="co">#&gt;   AE006468-_Salmonella_enterica_subsp._enterica-_Bacteria-Pseudomonadota-Gammaproteobacteria-Enterobacterales-Enterobacteriaceae-Salmonella-_c-_type_sp., AF008580-_Salmonella_enterica_subsp._arizonae-_Bacteria-Pseudomonadota-Gammaproteobacteria-Enterobacterales-Enterobacteriaceae-Salmonella-_c, MK942857-_Klebsiella_indica-_Bacteria-Pseudomonadota-Gammaproteobacteria-Enterobacterales-Enterobacteriaceae-Klebsiella-_c, EU014680-_Salmonella_enterica_subsp._indica-_Bacteria-Pseudomonadota-Gammaproteobacteria-Enterobacterales-Enterobacteriaceae-Salmonella-_c, EU014684-_Salmonella_enterica_subsp._houtenae-_Bacteria-Pseudomonadota-Gammaproteobacteria-Enterobacterales-Enterobacteriaceae-Salmonella-_c, EU014685-_Salmonella_enterica_subsp._salamae-_Bacteria-Pseudomonadota-Gammaproteobacteria-Enterobacterales-Enterobacteriaceae-Salmonella-_c, ...</span></span>
<span><span class="co">#&gt; Node labels:</span></span>
<span><span class="co">#&gt;   2157, n19454, 2+48381, n19456, n19457, 200940+57723+533205, ...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Rooted; includes branch lengths.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="phylogenetic-tree">Phylogenetic tree<a class="anchor" aria-label="anchor" href="#phylogenetic-tree"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tip_data</span> <span class="op">&lt;-</span> <span class="va">ltp</span><span class="op">$</span><span class="va">tip_data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">tip_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 18325    14</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="some-completeness-stats">Some completeness stats<a class="anchor" aria-label="anchor" href="#some-completeness-stats"></a>
</h3>
<p>Annotations from sources than can be mapped to the NCBI tree:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ncbi_tree_nodes_gst</span> <span class="op">&lt;-</span> <span class="va">ncbi_tree_nodes</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">'^[gst]__'</span>, <span class="va">ncbi_tree_nodes</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">phys_data_ready</span><span class="op">$</span><span class="va">NCBI_ID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">ncbi_tree_nodes_gst</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.9725829</span></span></code></pre></div>
<p>Proportion of NCBI tree nodes (gst) with annotations:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ncbi_tree_nodes_gst</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">phys_data_ready</span><span class="op">$</span><span class="va">NCBI_ID</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.2080126</span></span></code></pre></div>
<p>Annotations from sources than can me mapped to the phylogenetic tree
tips:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">phys_data_ready</span><span class="op">$</span><span class="va">taxid</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">tip_data</span><span class="op">$</span><span class="va">taxid</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.1614774</span></span></code></pre></div>
<p>Proportion of tips in the phylogenetic tree with annotations:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">tip_data</span><span class="op">$</span><span class="va">taxid</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">phys_data_ready</span><span class="op">$</span><span class="va">taxid</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.5515962</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="increase-number-of-tips-with-annotations">Increase number of tips with annotations<a class="anchor" aria-label="anchor" href="#increase-number-of-tips-with-annotations"></a>
</h2>
<div class="section level3">
<h3 id="map-ncbi-ids-to-the-ncbi-taxonomic-tree">Map NCBI IDs to the NCBI taxonomic tree<a class="anchor" aria-label="anchor" href="#map-ncbi-ids-to-the-ncbi-taxonomic-tree"></a>
</h3>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ncbi_tree</span><span class="op">$</span><span class="fu">Do</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">node</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">node</span><span class="op">$</span><span class="va">name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">phys_data_list</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">node</span><span class="op">$</span><span class="va">attribute_tbl</span> <span class="op">&lt;-</span> <span class="va">phys_data_list</span><span class="op">[[</span><span class="va">node</span><span class="op">$</span><span class="va">name</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="va">node</span><span class="op">$</span><span class="va">attribute_tbl</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">## An example (E. coli):</span></span>
<span><span class="va">ncbi_tree</span><span class="op">$</span><span class="va">k__2</span><span class="op">$</span><span class="va">p__1224</span><span class="op">$</span><span class="va">c__1236</span><span class="op">$</span><span class="va">o__91347</span><span class="op">$</span><span class="va">f__543</span><span class="op">$</span><span class="va">g__561</span><span class="op">$</span><span class="va">s__562</span><span class="op">$</span><span class="va">attribute_tbl</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 12</span></span></span>
<span><span class="co">#&gt;   NCBI_ID Attribute     Taxon_name Rank  Attribute_source Confidence_in_curation</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;ord&gt;</span>                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> s__562  aerobic       Escherich… spec… Madin_2020       medium                </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> s__562  aerotolerant  <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> s__562  anaerobic     <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> s__562  facultativel… Escherich… spec… ProTraits        medium                </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 6 more variables: Evidence &lt;chr&gt;, Frequency &lt;chr&gt;, Score &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Attribute_group &lt;chr&gt;, Attribute_type &lt;chr&gt;, taxid &lt;chr&gt;</span></span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ncbi_attr_gst</span> <span class="op">&lt;-</span> <span class="va">ncbi_tree</span><span class="op">$</span><span class="fu">Get</span><span class="op">(</span></span>
<span>    <span class="st">'attribute_tbl'</span>, filterFun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">node</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">'^[gst]__'</span>, <span class="va">node</span><span class="op">$</span><span class="va">name</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_lgl</a></span><span class="op">(</span><span class="va">ncbi_attr_gst</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.2080126</span></span></code></pre></div>
<p>Removing annotations just to compare with result after taxonomic
pooling</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ncbi_tree</span><span class="op">$</span><span class="va">k__2</span><span class="op">$</span><span class="va">p__1224</span><span class="op">$</span><span class="va">c__1236</span><span class="op">$</span><span class="va">o__91347</span><span class="op">$</span><span class="va">f__543</span><span class="op">$</span><span class="va">g__561</span><span class="op">$</span><span class="va">attribute_tbl</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">ncbi_tree</span><span class="op">$</span><span class="va">k__2</span><span class="op">$</span><span class="va">p__1224</span><span class="op">$</span><span class="va">c__1236</span><span class="op">$</span><span class="va">o__91347</span><span class="op">$</span><span class="va">f__543</span><span class="op">$</span><span class="va">g__561</span><span class="op">$</span><span class="va">attribute_tbl</span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
<p>Lest pool and normalize attribute scores at each taxonomic rank (gst)
for child taxa</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## ASR - post-order</span></span>
<span><span class="va">taxPool</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">node</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">node</span><span class="op">$</span><span class="va">isLeaf</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">children_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">node</span><span class="op">$</span><span class="va">children</span><span class="op">)</span></span>
<span>        <span class="va">attribute_tbls</span> <span class="op">&lt;-</span> <span class="va">children_names</span> <span class="op">|&gt;</span> </span>
<span>            <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="op">~</span> <span class="va">node</span><span class="op">[[</span><span class="va">.x</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">attribute_tbl</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html" class="external-link">discard</a></span><span class="op">(</span><span class="va">is.null</span><span class="op">)</span></span>
<span>        <span class="va">not_all_children_tbls_are_null</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">attribute_tbls</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span></span>
<span>        <span class="va">node_attribute_tbl_is_null</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">node</span><span class="op">$</span><span class="va">table</span><span class="op">)</span></span>
<span>        <span class="va">node_is_gst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">'^[gst]__'</span>, <span class="va">node</span><span class="op">$</span><span class="va">name</span><span class="op">)</span></span>
<span>        <span class="va">conds</span> <span class="op">&lt;-</span> <span class="va">node_attribute_tbl_is_null</span> <span class="op">&amp;</span> </span>
<span>            <span class="va">not_all_children_tbls_are_null</span> <span class="op">&amp;</span></span>
<span>            <span class="va">node_is_gst</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">conds</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">res_tbl</span> <span class="op">&lt;-</span> <span class="va">attribute_tbls</span> <span class="op">|&gt;</span> </span>
<span>                <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html" class="external-link">discard</a></span><span class="op">(</span><span class="va">is.null</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>                <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>                <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>                    <span class="va">NCBI_ID</span>, <span class="va">Attribute</span>, <span class="va">Score</span></span>
<span>                <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>                <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>                    NCBI_ID <span class="op">=</span> <span class="va">node</span><span class="op">$</span><span class="va">name</span>,</span>
<span>                    taxid <span class="op">=</span> <span class="va">node</span><span class="op">$</span><span class="va">taxid</span>,</span>
<span>                    Taxon_name <span class="op">=</span> <span class="va">node</span><span class="op">$</span><span class="va">Taxon_name</span>,</span>
<span>                    Rank <span class="op">=</span> <span class="va">node</span><span class="op">$</span><span class="va">Rank</span>,</span>
<span>                    Evidence <span class="op">=</span> <span class="st">'tax'</span>,</span>
<span>                    Attribute_group <span class="op">=</span> <span class="va">Attribute_group_var</span>,</span>
<span>                    Attribute_type <span class="op">=</span> <span class="va">Attribute_type_var</span></span>
<span>                <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">NCBI_ID</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>                    Total_score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Score</span><span class="op">)</span>,</span>
<span>                    Score <span class="op">=</span> <span class="va">Score</span> <span class="op">/</span> <span class="va">Total_score</span></span>
<span>                <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Total_score</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">NCBI_ID</span>, <span class="va">Attribute</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Score</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>                    Frequency <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>                        <span class="va">Score</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">'always'</span>,</span>
<span>                        <span class="va">Score</span> <span class="op">&gt;</span> <span class="fl">0.9</span> <span class="op">~</span> <span class="st">'usually'</span>,</span>
<span>                        <span class="va">Score</span> <span class="op">&gt;=</span> <span class="fl">0.5</span> <span class="op">~</span> <span class="st">'sometimes'</span>,</span>
<span>                        <span class="va">Score</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">Score</span> <span class="op">&lt;</span> <span class="fl">0.5</span> <span class="op">~</span> <span class="st">'rarely'</span>,</span>
<span>                        <span class="va">Score</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">'never'</span></span>
<span>                    <span class="op">)</span></span>
<span>                <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>                    Attribute_source <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>                    Confidence_in_curation <span class="op">=</span> <span class="cn">NA</span></span>
<span>                <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span></span>
<span>                <span class="va">node</span><span class="op">[[</span><span class="st">'attribute_tbl'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">res_tbl</span></span>
<span>        <span class="op">}</span> </span>
<span>    <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">ncbi_tree</span><span class="op">$</span><span class="fu">Do</span><span class="op">(</span><span class="va">taxPool</span>, traversal <span class="op">=</span> <span class="st">'post-order'</span><span class="op">)</span></span>
<span><span class="co">## Same E. coli example:</span></span>
<span><span class="va">ncbi_tree</span><span class="op">$</span><span class="va">k__2</span><span class="op">$</span><span class="va">p__1224</span><span class="op">$</span><span class="va">c__1236</span><span class="op">$</span><span class="va">o__91347</span><span class="op">$</span><span class="va">f__543</span><span class="op">$</span><span class="va">g__561</span><span class="op">$</span><span class="va">attribute_tbl</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 12</span></span></span>
<span><span class="co">#&gt;   NCBI_ID Attribute        Score taxid Taxon_name Rank  Evidence Attribute_group</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> g__561  aerobic        0.059<span style="text-decoration: underline;">8</span>  561   Escherich… genus tax      aerophilicity  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> g__561  aerotolerant   0       561   Escherich… genus tax      aerophilicity  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> g__561  anaerobic      0.004<span style="text-decoration: underline;">27</span> 561   Escherich… genus tax      aerophilicity  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> g__561  facultatively… 0.936   561   Escherich… genus tax      aerophilicity  </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4 more variables: Attribute_type &lt;chr&gt;, Frequency &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Attribute_source &lt;lgl&gt;, Confidence_in_curation &lt;lgl&gt;</span></span></span></code></pre></div>
<p>How many nodes family and above with attribute table? (it should be
zero)</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ncbi_attr_kpcof</span> <span class="op">&lt;-</span> <span class="va">ncbi_tree</span><span class="op">$</span><span class="fu">Get</span><span class="op">(</span></span>
<span>    <span class="st">'attribute_tbl'</span>, filterFun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">node</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">'^[dpcor]__'</span>, <span class="va">node</span><span class="op">$</span><span class="va">name</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_lgl</a></span><span class="op">(</span><span class="va">ncbi_attr_kpcof</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code></pre></div>
<p>How many nodes genus and below with attribute table?</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ncbi_attr_gst</span> <span class="op">&lt;-</span> <span class="va">ncbi_tree</span><span class="op">$</span><span class="fu">Get</span><span class="op">(</span></span>
<span>    <span class="st">'attribute_tbl'</span>, filterFun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">node</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">'^[gst]__'</span>, <span class="va">node</span><span class="op">$</span><span class="va">name</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">## A slight increase 12 to 15%</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_lgl</a></span><span class="op">(</span><span class="va">ncbi_attr_gst</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.2452853</span></span></code></pre></div>
<p>Child taxa of E. coli with unobserved annotations can inherit these
values with a slight penalty:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Inheritance - pre-order</span></span>
<span><span class="va">inh1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">node</span>,  <span class="va">adjF</span> <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">node</span><span class="op">$</span><span class="va">isRoot</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">node</span><span class="op">$</span><span class="va">parent</span><span class="op">$</span><span class="va">attribute_tbl</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">node</span><span class="op">$</span><span class="va">attribute_tbl</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">'^[st]__'</span>, <span class="va">node</span><span class="op">$</span><span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">df</span> <span class="op">&lt;-</span> <span class="va">node</span><span class="op">$</span><span class="va">parent</span><span class="op">$</span><span class="va">attribute_tbl</span></span>
<span>        <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span>        <span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>                target_scores <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="va">n</span>, <span class="va">n</span><span class="op">)</span>,</span>
<span>                score_diff <span class="op">=</span> <span class="va">Score</span> <span class="op">-</span> <span class="va">target_scores</span>,</span>
<span>                Score <span class="op">=</span> <span class="va">Score</span> <span class="op">-</span> <span class="va">adjF</span> <span class="op">*</span> <span class="va">score_diff</span>,</span>
<span>                NCBI_ID <span class="op">=</span> <span class="va">node</span><span class="op">$</span><span class="va">name</span>,</span>
<span>                Evidence <span class="op">=</span> <span class="st">'inh'</span>,</span>
<span>                Taxon_name <span class="op">=</span> <span class="va">node</span><span class="op">$</span><span class="va">Taxon_name</span>,</span>
<span>                Rank <span class="op">=</span> <span class="va">node</span><span class="op">$</span><span class="va">Rank</span>,</span>
<span>                taxid <span class="op">=</span> <span class="va">node</span><span class="op">$</span><span class="va">taxid</span>,</span>
<span>            <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>            <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">target_scores</span>, <span class="op">-</span><span class="va">score_diff</span><span class="op">)</span></span>
<span>        <span class="va">node</span><span class="op">$</span><span class="va">attribute_tbl</span> <span class="op">&lt;-</span> <span class="va">df</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">ncbi_tree</span><span class="op">$</span><span class="fu">Do</span><span class="op">(</span><span class="va">inh1</span>, traversal <span class="op">=</span> <span class="st">'pre-order'</span><span class="op">)</span></span></code></pre></div>
<p>Let’s look at one example of inheritance</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inh_nodes1</span> <span class="op">&lt;-</span> <span class="va">ncbi_tree</span><span class="op">$</span><span class="fu">Get</span><span class="op">(</span></span>
<span>    <span class="st">'attribute_tbl'</span>, </span>
<span>    simplify <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    filterFun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">node</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">node</span><span class="op">$</span><span class="va">attribute_tbl</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="st">'inh'</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">node</span><span class="op">$</span><span class="va">attribute_tbl</span><span class="op">$</span><span class="va">Evidence</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>            <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">inh_nodes1_subset</span> <span class="op">&lt;-</span> <span class="va">inh_nodes1</span><span class="op">[</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_int</a></span><span class="op">(</span><span class="va">inh_nodes1</span>, <span class="va">nrow</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">inh_nodes1_subset</span><span class="op">[[</span><span class="st">'s__2588497'</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 12</span></span></span>
<span><span class="co">#&gt;   NCBI_ID    Attribute     Score taxid Taxon_name Rank  Evidence Attribute_group</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> s__2588497 aerobic       0.588 2588… Noviherba… spec… inh      aerophilicity  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> s__2588497 aerotolerant  0.025 2588… Noviherba… spec… inh      aerophilicity  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> s__2588497 anaerobic     0.025 2588… Noviherba… spec… inh      aerophilicity  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> s__2588497 facultativel… 0.362 2588… Noviherba… spec… inh      aerophilicity  </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4 more variables: Attribute_type &lt;chr&gt;, Frequency &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Attribute_source &lt;lgl&gt;, Confidence_in_curation &lt;lgl&gt;</span></span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">parent1</span> <span class="op">&lt;-</span> <span class="va">ncbi_tree</span><span class="op">$</span><span class="fu">Get</span><span class="op">(</span></span>
<span>    <span class="st">'attribute_tbl'</span>, </span>
<span>    simplify <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    filterFun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">node</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">node</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">'g__1344552'</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span><span class="va">parent1</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 12</span></span></span>
<span><span class="co">#&gt;   NCBI_ID    Attribute     Score taxid Taxon_name Rank  Evidence Attribute_group</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> g__1344552 aerobic       0.625 1344… Noviherba… genus tax      aerophilicity  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> g__1344552 aerotolerant  0     1344… Noviherba… genus tax      aerophilicity  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> g__1344552 anaerobic     0     1344… Noviherba… genus tax      aerophilicity  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> g__1344552 facultativel… 0.375 1344… Noviherba… genus tax      aerophilicity  </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4 more variables: Attribute_type &lt;chr&gt;, Frequency &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Attribute_source &lt;lgl&gt;, Confidence_in_curation &lt;lgl&gt;</span></span></span></code></pre></div>
<p>Proportion of nodes at the family level and above with attributes (it
should be zero):</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ncbi_attr_kpcof</span> <span class="op">&lt;-</span> <span class="va">ncbi_tree</span><span class="op">$</span><span class="fu">Get</span><span class="op">(</span></span>
<span>    <span class="st">'attribute_tbl'</span>, filterFun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">node</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">'^[kpcor]__'</span>, <span class="va">node</span><span class="op">$</span><span class="va">name</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_lgl</a></span><span class="op">(</span><span class="va">ncbi_attr_kpcof</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code></pre></div>
<p>Proportion of nodes at the genus, species, and strain levels with
attributes:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ncbi_attr_gst</span> <span class="op">&lt;-</span> <span class="va">ncbi_tree</span><span class="op">$</span><span class="fu">Get</span><span class="op">(</span></span>
<span>    <span class="st">'attribute_tbl'</span>, filterFun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">node</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">'^[gst]__'</span>, <span class="va">node</span><span class="op">$</span><span class="va">name</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">## Major increase 15 to 78%</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_lgl</a></span><span class="op">(</span><span class="va">ncbi_attr_gst</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.8215899</span></span></code></pre></div>
<p>The step above actually covered must of the genus, species, and
strains, but this is one of the datasets with the most annotations, so
it’s expected that most of the taxa would already be covered.</p>
<p>A formal ASR method would be nice, however.</p>
<p>Get new attributes:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_attributes</span> <span class="op">&lt;-</span> <span class="va">ncbi_attr_gst</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html" class="external-link">discard</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">NCBI_ID</span>, <span class="va">Attribute</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">NCBI_ID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">phys_data_ready</span><span class="op">$</span><span class="va">NCBI_ID</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>taxid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">'^\\w__'</span>, <span class="st">''</span>, <span class="va">NCBI_ID</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">phys_data_ready</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">new_attributes</span><span class="op">$</span><span class="va">Evidence</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    exp    igc    inh    nas    tas    tax </span></span>
<span><span class="co">#&gt;   3829   1377 171008    918   3485  17562</span></span></code></pre></div>
<p>Now almost 90% of the tips have annotations:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">tip_data</span><span class="op">$</span><span class="va">taxid</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">new_attributes</span><span class="op">$</span><span class="va">taxid</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.9175443</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_tip_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">tip_data</span>, <span class="va">new_attributes</span>, by <span class="op">=</span> <span class="st">'taxid'</span><span class="op">)</span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">new_tip_data</span><span class="op">$</span><span class="va">Evidence</span>, useNA <span class="op">=</span> <span class="st">'always'</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   exp   igc   inh   nas   tas   tax  &lt;NA&gt; </span></span>
<span><span class="co">#&gt;  1252   396 25100   156  2672  7496  1511</span></span></code></pre></div>
<p>Let’s create an input matrix for ASR with the phylogenetic tree</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_tip_data_completed</span> <span class="op">&lt;-</span> <span class="va">new_tip_data</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">tip_label</span>, <span class="va">Attribute</span>, <span class="va">Score</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Attribute</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/complete.html" class="external-link">complete</a></span><span class="op">(</span><span class="va">tip_label</span>, <span class="va">Attribute</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Score <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="va">new_tip_data_completed</span> <span class="op">|&gt;</span> </span>
<span>    <span class="co"># select(tip_label, Attribute, Score) |&gt; </span></span>
<span>    <span class="co"># filter(!is.na(Attribute)) |&gt; </span></span>
<span>    <span class="co"># complete(tip_label, Attribute, fill = list(Score = 0)) |&gt;</span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span></span>
<span>        names_from <span class="op">=</span> <span class="st">'Attribute'</span>, values_from <span class="op">=</span> <span class="st">'Score'</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">column_to_rownames</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">'tip_label'</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">no_annotated_tips</span> <span class="op">&lt;-</span> <span class="va">new_tip_data</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">tip_label</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">tip_label</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">no_annotated_tips</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="op">(</span><span class="va">no_annotated_tips</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    byrow <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>rownames <span class="op">=</span> <span class="va">no_annotated_tips</span>, colnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">m3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">m1</span>, <span class="va">m2</span><span class="op">)</span></span>
<span><span class="va">m3</span> <span class="op">&lt;-</span> <span class="va">m3</span><span class="op">[</span><span class="va">tree</span><span class="op">$</span><span class="va">tip.label</span>,<span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">m3</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 18325     4</span></span></code></pre></div>
<p>Histogram of probabilites for tips with annotations</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">m1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="va">x</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">prob</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">'Tips with annotations, all probabilities'</span><span class="op">)</span></span></code></pre></div>
<p><img src="phytools_files/figure-html/unnamed-chunk-30-1.png" width="700"></p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">as.double</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">m1</span>, <span class="fl">1</span>, <span class="va">max</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="va">y</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">prob</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">'Tips with annotations, max probabilities'</span><span class="op">)</span></span></code></pre></div>
<p><img src="phytools_files/figure-html/unnamed-chunk-31-1.png" width="700"></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">z</span> <span class="op">&lt;-</span> <span class="va">m3</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="va">z</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">prob</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">'All tips, all probabilities'</span><span class="op">)</span></span></code></pre></div>
<p><img src="phytools_files/figure-html/unnamed-chunk-32-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="asr-with-phytools">ASR with phytools<a class="anchor" aria-label="anchor" href="#asr-with-phytools"></a>
</h2>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phytools/man/fitMk.html" class="external-link">fitMk</a></span><span class="op">(</span></span>
<span>        tree <span class="op">=</span> <span class="va">tree</span>, x <span class="op">=</span> <span class="va">m3</span>, model <span class="op">=</span> <span class="st">'ER'</span>, pi <span class="op">=</span> <span class="st">'fitzjohn'</span>, </span>
<span>        lik.func <span class="op">=</span> <span class="st">'pruning'</span>, logscale <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">asr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phytools/man/ancr.html" class="external-link">ancr</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">fit</span>, tips <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt; 178.096 128.287 153.991</span></span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="va">asr</span><span class="op">$</span><span class="va">ace</span></span>
<span><span class="va">node_rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">tree</span><span class="op">$</span><span class="va">tip.label</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">:</span><span class="va">tree</span><span class="op">$</span><span class="va">Nnode</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">[</span><span class="va">node_rows</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">tree</span><span class="op">$</span><span class="va">node.label</span></span></code></pre></div>
<p>Probabilities of internal nodes</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">as.double</a></span><span class="op">(</span><span class="va">res</span><span class="op">[</span><span class="va">tree</span><span class="op">$</span><span class="va">node.label</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">prob</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">'Internal nodes, all probabilities'</span><span class="op">)</span></span></code></pre></div>
<p><img src="phytools_files/figure-html/unnamed-chunk-35-1.png" width="700"></p>
<p>Probabilities of tips</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">as.double</a></span><span class="op">(</span><span class="va">res</span><span class="op">[</span><span class="va">tree</span><span class="op">$</span><span class="va">tip.label</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">prob</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">'Tips, all probabilities (after ASR)'</span><span class="op">)</span></span></code></pre></div>
<p><img src="phytools_files/figure-html/unnamed-chunk-36-1.png" width="700"></p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">maxRes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">res</span>, <span class="fl">1</span>, <span class="va">max</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="va">maxRes</span><span class="op">[</span><span class="va">tree</span><span class="op">$</span><span class="va">node.label</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">prob</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">'Internal nodes, max probabilities'</span><span class="op">)</span></span></code></pre></div>
<p><img src="phytools_files/figure-html/unnamed-chunk-37-1.png" width="700"></p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="va">maxRes</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">prob</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">'New tips, max probabilities'</span><span class="op">)</span></span></code></pre></div>
<p><img src="phytools_files/figure-html/unnamed-chunk-38-1.png" width="700"></p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_taxa_from_tips</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span>,<span class="op">]</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames_to_column</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">'tip_label'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">tip_data</span>, by <span class="op">=</span> <span class="st">'tip_label'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        Rank <span class="op">=</span> <span class="fu">taxizedb</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/taxizedb/reference/taxid2rank.html" class="external-link">taxid2rank</a></span><span class="op">(</span><span class="va">taxid</span>, db <span class="op">=</span> <span class="st">'ncbi'</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Rank</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'genus'</span>, <span class="st">'species'</span>, <span class="st">'strain'</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        NCBI_ID <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>            <span class="va">Rank</span> <span class="op">==</span> <span class="st">'genus'</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'g__'</span>, <span class="va">taxid</span><span class="op">)</span>,</span>
<span>            <span class="va">Rank</span> <span class="op">==</span> <span class="st">'species'</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'s__'</span>, <span class="va">taxid</span><span class="op">)</span>,</span>
<span>            <span class="va">Rank</span> <span class="op">==</span> <span class="st">'strain'</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'t__'</span>, <span class="va">taxid</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="co"># rename(Taxon_name = taxname) |&gt; </span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">'_taxid'</span><span class="op">)</span>, <span class="op">-</span><span class="va">tip_label</span>, <span class="op">-</span><span class="va">taxid</span>, <span class="op">-</span><span class="va">accession</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">NCBI_ID</span>, <span class="va">Taxon_name</span>, <span class="va">Rank</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>        names_to <span class="op">=</span> <span class="st">'Attribute'</span>, values_to <span class="op">=</span> <span class="st">'Score'</span>, cols <span class="op">=</span> <span class="fl">4</span><span class="op">:</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">last_col</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        Evidence <span class="op">=</span> <span class="st">'asr'</span>,</span>
<span>        Attribute_source <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>        Confidence_in_curation <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>        taxid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">'\\w__'</span>, <span class="st">''</span>, <span class="va">NCBI_ID</span><span class="op">)</span>,</span>
<span>        Attribute_type <span class="op">=</span> <span class="va">Attribute_type_var</span>,</span>
<span>        Attribute_group <span class="op">=</span> <span class="va">Attribute_group_var</span>,</span>
<span>        Frequency <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>            <span class="va">Score</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">'always'</span>,</span>
<span>            <span class="va">Score</span> <span class="op">&gt;</span> <span class="fl">0.9</span> <span class="op">~</span> <span class="st">'usually'</span>,</span>
<span>            <span class="va">Score</span> <span class="op">&gt;=</span> <span class="fl">0.5</span> <span class="op">~</span> <span class="st">'sometimes'</span>,</span>
<span>            <span class="va">Score</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">Score</span> <span class="op">&lt;</span> <span class="fl">0.5</span> <span class="op">~</span> <span class="st">'rarely'</span>,</span>
<span>            <span class="va">Score</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">'never'</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">new_taxa_from_tips</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 12</span></span></span>
<span><span class="co">#&gt;   NCBI_ID    Taxon_name        Rank  Attribute   Score Evidence Attribute_source</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> s__2899544 Intestinirhabdus… spec… aerobic   0.063<span style="text-decoration: underline;">1</span>  asr      <span style="color: #BB0000;">NA</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> s__2899544 Intestinirhabdus… spec… aerotole… 0.007<span style="text-decoration: underline;">93</span> asr      <span style="color: #BB0000;">NA</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> s__2899544 Intestinirhabdus… spec… anaerobic 0.007<span style="text-decoration: underline;">93</span> asr      <span style="color: #BB0000;">NA</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> s__2899544 Intestinirhabdus… spec… facultat… 0.921   asr      <span style="color: #BB0000;">NA</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> s__2799638 Tenebrionibacter… spec… aerobic   0.888   asr      <span style="color: #BB0000;">NA</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> s__2799638 Tenebrionibacter… spec… aerotole… 0.037<span style="text-decoration: underline;">1</span>  asr      <span style="color: #BB0000;">NA</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5 more variables: Confidence_in_curation &lt;lgl&gt;, taxid &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Attribute_type &lt;chr&gt;, Attribute_group &lt;chr&gt;, Frequency &lt;chr&gt;</span></span></span></code></pre></div>
<p>Most of these new taxa are in the NCBI tree:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ncbi_tree_nodes_empty</span> <span class="op">&lt;-</span> <span class="va">ncbi_tree</span><span class="op">$</span><span class="fu">Get</span><span class="op">(</span></span>
<span>    <span class="st">'attribute_tbl'</span>, filterFun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">node</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">node</span><span class="op">$</span><span class="va">attribute_tbl</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">node</span><span class="op">$</span><span class="va">attribute_tbl</span><span class="op">)</span><span class="op">)</span>   </span>
<span>    <span class="op">}</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="op">{</span>\<span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">}</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">new_taxa_from_tips</span><span class="op">$</span><span class="va">NCBI_ID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">ncbi_tree_nodes_empty</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.7801252</span></span></code></pre></div>
<p>Let’s check nodes</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nodes_annotated</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">'^\\d+(\\+\\d+)*'</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">new_taxa_from_nodes</span> <span class="op">&lt;-</span> <span class="va">nodes_annotated</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames_to_column</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">'NCBI_ID'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>NCBI_ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">NCBI_ID</span>, <span class="st">'\\+'</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">NCBI_ID</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Rank <span class="op">=</span> <span class="fu">taxizedb</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/taxizedb/reference/taxid2rank.html" class="external-link">taxid2rank</a></span><span class="op">(</span><span class="va">NCBI_ID</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Rank <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">Rank</span> <span class="op">==</span> <span class="st">'superkingdom'</span>, <span class="st">'kingdom'</span>, <span class="va">Rank</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        NCBI_ID <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>            <span class="va">Rank</span> <span class="op">==</span> <span class="st">'kingdom'</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'k__'</span>, <span class="va">NCBI_ID</span><span class="op">)</span>,</span>
<span>            <span class="va">Rank</span> <span class="op">==</span> <span class="st">'phylum'</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'p__'</span>, <span class="va">NCBI_ID</span><span class="op">)</span>,</span>
<span>            <span class="va">Rank</span> <span class="op">==</span> <span class="st">'class'</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'c__'</span>, <span class="va">NCBI_ID</span><span class="op">)</span>,</span>
<span>            <span class="va">Rank</span> <span class="op">==</span> <span class="st">'order'</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'o__'</span>, <span class="va">NCBI_ID</span><span class="op">)</span>,</span>
<span>            <span class="va">Rank</span> <span class="op">==</span> <span class="st">'family'</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'f__'</span>, <span class="va">NCBI_ID</span><span class="op">)</span>,</span>
<span>            <span class="va">Rank</span> <span class="op">==</span> <span class="st">'genus'</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'g__'</span>, <span class="va">NCBI_ID</span><span class="op">)</span>,</span>
<span>            <span class="va">Rank</span> <span class="op">==</span> <span class="st">'species'</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'s__'</span>, <span class="va">NCBI_ID</span><span class="op">)</span>,</span>
<span>            <span class="va">Rank</span> <span class="op">==</span> <span class="st">'strain'</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'t__'</span>, <span class="va">NCBI_ID</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>        <span class="va">Rank</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>            <span class="st">'kingdom'</span>, <span class="st">'phylum'</span>, <span class="st">'class'</span>, <span class="st">'order'</span>, <span class="st">'family'</span>, <span class="st">'genus'</span>,</span>
<span>            <span class="st">'species'</span>, <span class="st">'strain'</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Evidence <span class="op">=</span> <span class="st">'asr'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">NCBI_ID</span>, <span class="va">Rank</span>, <span class="va">Evidence</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>        cols <span class="op">=</span> <span class="fl">4</span><span class="op">:</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">last_col</a></span><span class="op">(</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">'Attribute'</span>, values_to <span class="op">=</span> <span class="st">'Score'</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        Attribute_source <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>        Confidence_in_curation <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>        Attribute_group <span class="op">=</span> <span class="va">Attribute_group_var</span>,</span>
<span>        Attribute_type <span class="op">=</span> <span class="va">Attribute_type_var</span>,</span>
<span>        taxid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">'\\w__'</span>, <span class="st">''</span>, <span class="va">NCBI_ID</span><span class="op">)</span>,</span>
<span>        Taxon_name <span class="op">=</span> <span class="fu">taxizedb</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/taxizedb/reference/taxid2name.html" class="external-link">taxid2name</a></span><span class="op">(</span><span class="va">taxid</span>, db <span class="op">=</span> <span class="st">'ncbi'</span><span class="op">)</span>,</span>
<span>        Frequency <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>            <span class="va">Score</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">'always'</span>,</span>
<span>            <span class="va">Score</span> <span class="op">&gt;</span> <span class="fl">0.9</span> <span class="op">~</span> <span class="st">'usually'</span>,</span>
<span>            <span class="va">Score</span> <span class="op">&gt;=</span> <span class="fl">0.5</span> <span class="op">~</span> <span class="st">'sometimes'</span>,</span>
<span>            <span class="va">Score</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">Score</span> <span class="op">&lt;</span> <span class="fl">0.5</span> <span class="op">~</span> <span class="st">'rarely'</span>,</span>
<span>            <span class="va">Score</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">'never'</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">new_taxa_from_nodes</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 12</span></span></span>
<span><span class="co">#&gt;   NCBI_ID Rank    Evidence Attribute                   Score Attribute_source</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> k__2157 kingdom asr      aerobic                 0.000<span style="text-decoration: underline;">012</span>7 <span style="color: #BB0000;">NA</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> k__2157 kingdom asr      aerotolerant            0.000<span style="text-decoration: underline;">012</span>2 <span style="color: #BB0000;">NA</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> k__2157 kingdom asr      anaerobic               1.00      <span style="color: #BB0000;">NA</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> k__2157 kingdom asr      facultatively anaerobic 0.000<span style="text-decoration: underline;">012</span>2 <span style="color: #BB0000;">NA</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> k__2    kingdom asr      aerobic                 0.000<span style="text-decoration: underline;">180</span>  <span style="color: #BB0000;">NA</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> k__2    kingdom asr      aerotolerant            0.000<span style="text-decoration: underline;">024</span>1 <span style="color: #BB0000;">NA</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 6 more variables: Confidence_in_curation &lt;lgl&gt;, Attribute_group &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Attribute_type &lt;chr&gt;, taxid &lt;chr&gt;, Taxon_name &lt;chr&gt;, Frequency &lt;chr&gt;</span></span></span></code></pre></div>
<p>Some new taxa can be added to the nodes with empty attribute
table:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">new_taxa_from_nodes</span><span class="op">$</span><span class="va">NCBI_ID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">ncbi_tree_nodes_empty</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.3287115</span></span></code></pre></div>
<p>Actually most are already in the tree, but we got them through
taxonomic binning (genus, species, and strains)</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">new_taxa_from_nodes</span><span class="op">$</span><span class="va">NCBI_ID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">ncbi_tree_nodes</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.9763274</span></span></code></pre></div>
<p>Prepare new taxa:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_taxa_for_ncbi_tree</span> <span class="op">&lt;-</span> <span class="va">new_taxa_from_tips</span> <span class="op">|&gt;</span> </span>
<span>    <span class="co"># select(-Taxon_name) |&gt; </span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">NCBI_ID</span>, <span class="va">Rank</span>, <span class="va">Attribute</span>, <span class="va">Score</span>, <span class="va">Evidence</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">new_taxa_from_nodes</span><span class="op">)</span></span>
<span><span class="va">new_taxa_for_ncbi_tree_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span></span>
<span>    <span class="va">new_taxa_for_ncbi_tree</span>, <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">new_taxa_for_ncbi_tree</span><span class="op">$</span><span class="va">NCBI_ID</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Let’s add some taxa to the tree:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ncbi_tree</span><span class="op">$</span><span class="fu">Do</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">node</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">cond1</span> <span class="op">&lt;-</span> <span class="va">node</span><span class="op">$</span><span class="va">name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">new_taxa_for_ncbi_tree_list</span><span class="op">)</span></span>
<span>    <span class="va">cond2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">node</span><span class="op">$</span><span class="va">attribute_tbl</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">node</span><span class="op">$</span><span class="va">attribute_tbl</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">cond1</span> <span class="op">&amp;&amp;</span> <span class="va">cond2</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">node</span><span class="op">$</span><span class="va">attribute_tbl</span> <span class="op">&lt;-</span> <span class="va">new_taxa_for_ncbi_tree_list</span><span class="op">[[</span><span class="va">node</span><span class="op">$</span><span class="va">name</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>How many are empty after this:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ncbi_tree_nodes_empty2</span> <span class="op">&lt;-</span> <span class="va">ncbi_tree</span><span class="op">$</span><span class="fu">Get</span><span class="op">(</span></span>
<span>    <span class="st">'attribute_tbl'</span>, filterFun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">node</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">node</span><span class="op">$</span><span class="va">attribute_tbl</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">node</span><span class="op">$</span><span class="va">attribute_tbl</span><span class="op">)</span><span class="op">)</span>   </span>
<span>    <span class="op">}</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="op">{</span>\<span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">}</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ncbi_tree_nodes_empty2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 12747</span></span></code></pre></div>
<p>ASR and Inheritance one more time:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inh2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">node</span>, <span class="va">adjF</span> <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">cond1</span> <span class="op">&lt;-</span> <span class="op">!</span><span class="va">node</span><span class="op">$</span><span class="va">isRoot</span></span>
<span>    <span class="va">cond2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">node</span><span class="op">$</span><span class="va">attribute_tbl</span><span class="op">)</span></span>
<span>    <span class="va">cond3</span> <span class="op">&lt;-</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">node</span><span class="op">$</span><span class="va">parent</span><span class="op">$</span><span class="va">attribute_tbl</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">cond1</span> <span class="op">&amp;&amp;</span> <span class="va">cond2</span> <span class="op">&amp;&amp;</span> <span class="va">cond3</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">tbl</span> <span class="op">&lt;-</span> <span class="va">node</span><span class="op">$</span><span class="va">parent</span><span class="op">$</span><span class="va">attribute_tbl</span>  </span>
<span>        <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">)</span></span>
<span>        <span class="va">res</span> <span class="op">&lt;-</span> <span class="va">tbl</span> <span class="op">|&gt;</span> </span>
<span>            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>                target_scores <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="va">n</span>, <span class="va">n</span><span class="op">)</span>,</span>
<span>                score_diff <span class="op">=</span> <span class="va">Score</span> <span class="op">-</span> <span class="va">target_scores</span>,</span>
<span>                Score <span class="op">=</span> <span class="va">Score</span> <span class="op">-</span> <span class="va">adjF</span> <span class="op">*</span> <span class="va">score_diff</span>,</span>
<span>                NCBI_ID <span class="op">=</span> <span class="va">node</span><span class="op">$</span><span class="va">name</span>,</span>
<span>                Evidence <span class="op">=</span> <span class="st">'inh2'</span></span>
<span>            <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">target_scores</span>, <span class="op">-</span><span class="va">score_diff</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">NCBI_ID</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>                Attribute_source <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>                Confidence_in_curation <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>                Attribute_group <span class="op">=</span> <span class="va">Attribute_group_var</span>,</span>
<span>                Attribute_type <span class="op">=</span> <span class="va">Attribute_type_var</span>,</span>
<span>                taxid <span class="op">=</span> <span class="va">node</span><span class="op">$</span><span class="va">taxid</span>,</span>
<span>                Taxon_name <span class="op">=</span> <span class="va">node</span><span class="op">$</span><span class="va">Taxon_name</span>,</span>
<span>                Rank <span class="op">=</span> <span class="va">node</span><span class="op">$</span><span class="va">Rank</span>,</span>
<span>                Frequency <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>                    <span class="va">Score</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">'always'</span>,</span>
<span>                    <span class="va">Score</span> <span class="op">&gt;</span> <span class="fl">0.9</span> <span class="op">~</span> <span class="st">'usually'</span>,</span>
<span>                    <span class="va">Score</span> <span class="op">&gt;=</span> <span class="fl">0.5</span> <span class="op">~</span> <span class="st">'sometimes'</span>,</span>
<span>                    <span class="va">Score</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">Score</span> <span class="op">&lt;</span> <span class="fl">0.5</span> <span class="op">~</span> <span class="st">'rarely'</span>,</span>
<span>                    <span class="va">Score</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">'never'</span></span>
<span>                <span class="op">)</span></span>
<span>            <span class="op">)</span></span>
<span>        <span class="va">node</span><span class="op">$</span><span class="va">attribute_tbl</span> <span class="op">&lt;-</span> <span class="va">res</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">ncbi_tree</span><span class="op">$</span><span class="fu">Do</span><span class="op">(</span><span class="va">taxPool</span>, traversal <span class="op">=</span> <span class="st">'post-order'</span><span class="op">)</span></span>
<span><span class="va">ncbi_tree</span><span class="op">$</span><span class="fu">Do</span><span class="op">(</span><span class="va">inh2</span>, traversal <span class="op">=</span> <span class="st">'pre-order'</span><span class="op">)</span></span></code></pre></div>
<p>How many are empty after this:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ncbi_tree_nodes_empty2</span> <span class="op">&lt;-</span> <span class="va">ncbi_tree</span><span class="op">$</span><span class="fu">Get</span><span class="op">(</span></span>
<span>    <span class="st">'attribute_tbl'</span>, filterFun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">node</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">node</span><span class="op">$</span><span class="va">attribute_tbl</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">node</span><span class="op">$</span><span class="va">attribute_tbl</span><span class="op">)</span><span class="op">)</span>   </span>
<span>    <span class="op">}</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="op">{</span>\<span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">}</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## Only the root (ArcBac) remains empty</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ncbi_tree_nodes_empty2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ncbi_tree</span><span class="op">$</span><span class="va">k__2</span><span class="op">$</span><span class="va">p__1224</span><span class="op">$</span><span class="va">c__28211</span><span class="op">$</span><span class="va">o__356</span><span class="op">$</span><span class="va">f__335928</span><span class="op">$</span><span class="va">attribute_tbl</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 12</span></span></span>
<span><span class="co">#&gt;   NCBI_ID   Rank   Attribute          Score Evidence Taxon_name Attribute_source</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> f__335928 family aerobic          1.00<span style="color: #949494;">e</span>+0 asr      Xanthobac… <span style="color: #BB0000;">NA</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> f__335928 family aerotolerant     4.31<span style="color: #949494;">e</span><span style="color: #BB0000;">-8</span> asr      Xanthobac… <span style="color: #BB0000;">NA</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> f__335928 family anaerobic        1.29<span style="color: #949494;">e</span><span style="color: #BB0000;">-6</span> asr      Xanthobac… <span style="color: #BB0000;">NA</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> f__335928 family facultatively a… 9.88<span style="color: #949494;">e</span><span style="color: #BB0000;">-8</span> asr      Xanthobac… <span style="color: #BB0000;">NA</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5 more variables: Confidence_in_curation &lt;lgl&gt;, taxid &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Attribute_type &lt;chr&gt;, Attribute_group &lt;chr&gt;, Frequency &lt;chr&gt;</span></span></span></code></pre></div>
<p>Get all the tables</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output</span> <span class="op">&lt;-</span> <span class="va">ncbi_tree</span><span class="op">$</span><span class="fu">Get</span><span class="op">(</span></span>
<span>    attribute <span class="op">=</span> <span class="st">'attribute_tbl'</span>, simplify <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    filterFun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">node</span><span class="op">)</span> <span class="va">node</span><span class="op">$</span><span class="va">name</span> <span class="op">!=</span> <span class="st">'ArcBac'</span></span>
<span>    <span class="op">)</span></span>
<span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 12</span></span></span>
<span><span class="co">#&gt;   NCBI_ID Rank    Attribute           Score Evidence Taxon_name Attribute_source</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> k__2    kingdom aerobic           1.80<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span> asr      Bacteria   <span style="color: #BB0000;">NA</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> k__2    kingdom aerotolerant      2.41<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span> asr      Bacteria   <span style="color: #BB0000;">NA</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> k__2    kingdom anaerobic         1.00<span style="color: #949494;">e</span>+0 asr      Bacteria   <span style="color: #BB0000;">NA</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> k__2    kingdom facultatively an… 2.41<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span> asr      Bacteria   <span style="color: #BB0000;">NA</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> p__1224 phylum  aerobic           8.46<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span> asr      Pseudomon… <span style="color: #BB0000;">NA</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> p__1224 phylum  aerotolerant      4.05<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span> asr      Pseudomon… <span style="color: #BB0000;">NA</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5 more variables: Confidence_in_curation &lt;ord&gt;, taxid &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Attribute_type &lt;chr&gt;, Attribute_group &lt;chr&gt;, Frequency &lt;chr&gt;</span></span></span></code></pre></div>
<p>Number of annotations per evidence</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">output</span><span class="op">$</span><span class="va">Evidence</span>, useNA <span class="op">=</span> <span class="st">'always'</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    asr    exp    igc    inh   inh2    nas    tas    tax   &lt;NA&gt; </span></span>
<span><span class="co">#&gt;   7256   2586    294 168108  48200    895   1837  39514  33958</span></span></code></pre></div>
<p>NAs are the one that were completed with tidyr::complete, so all of
them have score 0</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Evidence</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">Score</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code></pre></div>
<p>Final annotations passing the min threshold (0.25 for
aerophilicity)</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">min_thr</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">phys_data_ready</span><span class="op">$</span><span class="va">Attribute</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">addTaxa1</span> <span class="op">&lt;-</span> <span class="va">phys_data_ready</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">NCBI_ID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">output</span><span class="op">$</span><span class="va">NCBI_ID</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">addTaxa2</span> <span class="op">&lt;-</span> <span class="va">new_taxa_for_ncbi_tree</span><span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">NCBI_ID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">output</span><span class="op">$</span><span class="va">NCBI_ID</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">final_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">output</span>, <span class="va">addTaxa1</span>, <span class="va">addTaxa2</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Score</span> <span class="op">&gt;</span> <span class="va">min_thr</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">final_output</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 88733    12</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="session-information">Session information<a class="anchor" aria-label="anchor" href="#session-information"></a>
</h2>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sessioninfo</span><span class="fu">::</span><span class="fu"><a href="https://r-lib.github.io/sessioninfo/reference/session_info.html" class="external-link">session_info</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB; font-weight: bold;">─ Session info ───────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt;  <span style="color: #555555; font-style: italic;">setting </span> <span style="color: #555555; font-style: italic;">value</span></span></span>
<span><span class="co">#&gt;  version  R Under development (unstable) (2023-11-08 r85496)</span></span>
<span><span class="co">#&gt;  os       Ubuntu 22.04.3 LTS</span></span>
<span><span class="co">#&gt;  system   x86_64, linux-gnu</span></span>
<span><span class="co">#&gt;  ui       X11</span></span>
<span><span class="co">#&gt;  language en</span></span>
<span><span class="co">#&gt;  collate  en_US.UTF-8</span></span>
<span><span class="co">#&gt;  ctype    en_US.UTF-8</span></span>
<span><span class="co">#&gt;  tz       Etc/UTC</span></span>
<span><span class="co">#&gt;  date     2023-11-15</span></span>
<span><span class="co">#&gt;  pandoc   3.1.1 @ /usr/local/bin/ (via rmarkdown)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB; font-weight: bold;">─ Packages ───────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt;  <span style="color: #555555; font-style: italic;">package          </span> <span style="color: #555555; font-style: italic;">*</span> <span style="color: #555555; font-style: italic;">version   </span> <span style="color: #555555; font-style: italic;">date (UTC)</span> <span style="color: #555555; font-style: italic;">lib</span> <span style="color: #555555; font-style: italic;">source</span></span></span>
<span><span class="co">#&gt;  ape               * 5.7-1      <span style="color: #555555;">2023-03-13</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  bit                 4.0.5      <span style="color: #555555;">2022-11-15</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  bit64               4.0.5      <span style="color: #555555;">2020-08-30</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  blob                1.2.4      <span style="color: #555555;">2023-03-17</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  bold                1.3.0      <span style="color: #555555;">2023-05-02</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  bslib               0.5.1      <span style="color: #555555;">2023-08-11</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  bugphyzz          * 0.0.1.4    <span style="color: #555555;">2023-11-15</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">Github (waldronlab/bugphyzz@10f0e88)</span></span></span>
<span><span class="co">#&gt;  cachem              1.0.8      <span style="color: #555555;">2023-05-01</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  cli                 3.6.1      <span style="color: #555555;">2023-03-23</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  clusterGeneration   1.3.8      <span style="color: #555555;">2023-08-16</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  coda                0.19-4     <span style="color: #555555;">2020-09-30</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  codetools           0.2-19     <span style="color: #555555;">2023-02-01</span> <span style="color: #555555;">[2]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  colorspace          2.1-0      <span style="color: #555555;">2023-01-23</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  combinat            0.0-8      <span style="color: #555555;">2012-10-29</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  conditionz          0.1.0      <span style="color: #555555;">2019-04-24</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  crayon              1.5.2      <span style="color: #555555;">2022-09-29</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  crul                1.4.0      <span style="color: #555555;">2023-05-17</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  curl                5.1.0      <span style="color: #555555;">2023-10-02</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  data.table          1.14.8     <span style="color: #555555;">2023-02-17</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  data.tree         * 1.1.0      <span style="color: #555555;">2023-11-12</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  DBI                 1.1.3      <span style="color: #555555;">2022-06-18</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  dbplyr              2.4.0      <span style="color: #555555;">2023-10-26</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  desc                1.4.2      <span style="color: #555555;">2022-09-08</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  digest              0.6.33     <span style="color: #555555;">2023-07-07</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  doParallel          1.0.17     <span style="color: #555555;">2022-02-07</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  dplyr             * 1.1.3      <span style="color: #555555;">2023-09-03</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  evaluate            0.23       <span style="color: #555555;">2023-11-01</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  expm                0.999-7    <span style="color: #555555;">2023-01-09</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  fansi               1.0.5      <span style="color: #555555;">2023-10-08</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  farver              2.1.1      <span style="color: #555555;">2022-07-06</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  fastmap             1.1.1      <span style="color: #555555;">2023-02-24</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  fastmatch           1.1-4      <span style="color: #555555;">2023-08-18</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  foreach             1.5.2      <span style="color: #555555;">2022-02-02</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  fs                  1.6.3      <span style="color: #555555;">2023-07-20</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  generics            0.1.3      <span style="color: #555555;">2022-07-05</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  ggplot2           * 3.4.4      <span style="color: #555555;">2023-10-12</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  glue                1.6.2      <span style="color: #555555;">2022-02-24</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  gtable              0.3.4      <span style="color: #555555;">2023-08-21</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  highr               0.10       <span style="color: #555555;">2022-12-22</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  hms                 1.1.3      <span style="color: #555555;">2023-03-21</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  hoardr              0.5.3      <span style="color: #555555;">2023-01-26</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  htmltools           0.5.7      <span style="color: #555555;">2023-11-03</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  httpcode            0.3.0      <span style="color: #555555;">2020-04-10</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  igraph              1.5.1      <span style="color: #555555;">2023-08-10</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  iterators           1.0.14     <span style="color: #555555;">2022-02-05</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  jquerylib           0.1.4      <span style="color: #555555;">2021-04-26</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  jsonlite            1.8.7      <span style="color: #555555;">2023-06-29</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  knitr               1.45       <span style="color: #555555;">2023-10-30</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  labeling            0.4.3      <span style="color: #555555;">2023-08-29</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  lattice             0.22-5     <span style="color: #555555;">2023-10-24</span> <span style="color: #555555;">[2]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  lifecycle           1.0.4      <span style="color: #555555;">2023-11-07</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  magrittr            2.0.3      <span style="color: #555555;">2022-03-30</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  maps              * 3.4.1.1    <span style="color: #555555;">2023-11-03</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  MASS                7.3-60.1   <span style="color: #555555;">2023-11-09</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">local</span></span></span>
<span><span class="co">#&gt;  Matrix              1.6-2      <span style="color: #555555;">2023-11-08</span> <span style="color: #555555;">[2]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  memoise             2.0.1      <span style="color: #555555;">2021-11-26</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  mgsub               1.7.3      <span style="color: #555555;">2021-07-28</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  mnormt              2.1.1      <span style="color: #555555;">2022-09-26</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  munsell             0.5.0      <span style="color: #555555;">2018-06-12</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  nlme                3.1-163    <span style="color: #555555;">2023-08-09</span> <span style="color: #555555;">[2]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  numDeriv            <span style="color: #BB00BB; font-weight: bold;">2016.8-1.1</span> <span style="color: #555555;">2019-06-06</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  optimParallel       1.0-2      <span style="color: #555555;">2021-02-11</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  phangorn            2.11.1     <span style="color: #555555;">2023-01-23</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  phytools          * 2.0-3      <span style="color: #555555;">2023-11-09</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  pillar              1.9.0      <span style="color: #555555;">2023-03-22</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  pkgconfig           2.0.3      <span style="color: #555555;">2019-09-22</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  pkgdown             2.0.7      <span style="color: #555555;">2022-12-14</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  purrr             * 1.0.2      <span style="color: #555555;">2023-08-10</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  quadprog            1.5-8      <span style="color: #555555;">2019-11-20</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  R6                  2.5.1      <span style="color: #555555;">2021-08-19</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  ragg                1.2.6      <span style="color: #555555;">2023-10-10</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  rappdirs            0.3.3      <span style="color: #555555;">2021-01-31</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  Rcpp                1.0.11     <span style="color: #555555;">2023-07-06</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  readr               2.1.4      <span style="color: #555555;">2023-02-10</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  rlang               1.1.2      <span style="color: #555555;">2023-11-04</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  rmarkdown           2.25       <span style="color: #555555;">2023-09-18</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  rprojroot           2.0.4      <span style="color: #555555;">2023-11-05</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  RSQLite             2.3.3      <span style="color: #555555;">2023-11-04</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  sass                0.4.7      <span style="color: #555555;">2023-07-15</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  scales              1.2.1      <span style="color: #555555;">2022-08-20</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  scatterplot3d       0.3-44     <span style="color: #555555;">2023-05-05</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  sessioninfo         1.2.2      <span style="color: #555555;">2021-12-06</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  stringi             1.8.1      <span style="color: #555555;">2023-11-13</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  stringr             1.5.0      <span style="color: #555555;">2022-12-02</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  systemfonts         1.0.5      <span style="color: #555555;">2023-10-09</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  taxize              0.9.100    <span style="color: #555555;">2022-04-22</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  taxizedb            0.3.1      <span style="color: #555555;">2023-04-03</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  taxPPro           * 0.1.0      <span style="color: #555555;">2023-11-15</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">local</span></span></span>
<span><span class="co">#&gt;  textshaping         0.3.7      <span style="color: #555555;">2023-10-09</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  tibble              3.2.1      <span style="color: #555555;">2023-03-20</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  tidyr             * 1.3.0      <span style="color: #555555;">2023-01-24</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  tidyselect          1.2.0      <span style="color: #555555;">2022-10-10</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  tzdb                0.4.0      <span style="color: #555555;">2023-05-12</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  utf8                1.2.4      <span style="color: #555555;">2023-10-22</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  uuid                1.1-1      <span style="color: #555555;">2023-08-17</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  vctrs               0.6.4      <span style="color: #555555;">2023-10-12</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  vroom               1.6.4      <span style="color: #555555;">2023-10-02</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  withr               2.5.2      <span style="color: #555555;">2023-10-30</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  xfun                0.41       <span style="color: #555555;">2023-11-01</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  xml2                1.3.5      <span style="color: #555555;">2023-07-06</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  yaml                2.3.7      <span style="color: #555555;">2023-01-23</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  zoo                 1.8-12     <span style="color: #555555;">2023-04-13</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [1] /usr/local/lib/R/site-library</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [2] /usr/local/lib/R/library</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB; font-weight: bold;">──────────────────────────────────────────────────────────────────────────────</span></span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Samuel Gamboa.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
